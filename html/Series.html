<html>
<head>
	<title> Exercices rituels (s&#233;ries 1-35)</title>
	<link rel="stylesheet" href="./css/main.css">
	<script src="./js/exercice.js"></script>
</head>
<body bgcolor ="#11aabb" onload="initialize();">
	<h1> Exercices rituels (s&#233;ries 1-35) </h1>
	<p>
		<input type="button" class="main" id="start" value="Demarrer un test" onclick="start();" /> <input type="button" id="next" value="Prochain calcul" onclick="next();" /> <input type="button" id="check" value="Verifier" onclick="verify();" />
		Nombre de calculs<input type='text' id="maxValue" class='resp' name='resp' value="30">

		<div id="newCalcTable" class="main" />
<p>
	<div id="footer"></div>

	<script>
        size = randomValue();
		numberofrows = 0;
		numberOfErrors = 0;
		numberOfCalculs = 0;
		numberOfCalculsMax = document.getElementById("maxValue").value;
		const listOfAlreadyProcessedCalcul = [];
		const listOfUserResponse = [];
		const listOfCalculResponse = [];

		function initialize() {
			hiddenResponse();
            numberOfErrors = 0;
			numberOfCalculs = 0;
			listOfAlreadyProcessedCalcul.length = 0;
			listOfCalculResponse.length = 0;
		}

		function verify() {

			fillListOfUserResponse();

			var errors = getNumberOfErrors();

			alert("Vous avez " + errors + " erreurs sur " + numberOfCalculs + " calculs! (moyenne: " + (1 + ((numberOfCalculs - numberOfErrors) / (numberOfCalculs / 5))) + ")");

			showResponse();
		}

		function randomValue() {
			var random_int = Math.floor(Math.random() * 31);
			return random_int;
		}

		function start() {
            numberOfCalculsMax = document.getElementById("maxValue").value;
            numberOfErrors = 0;
			numberOfCalculs = 0;
			numberofrows = 0;
			listOfAlreadyProcessedCalcul.length = 0;
			listOfCalculResponse.length = 0;

			generateCalcTable();
		}

		function generateCalcTable() {
			size = randomValue();

			for (i = 0; i < listOfAlreadyProcessedCalcul; i++) {
				if (listOfAlreadyProcessedCalcul[0] == size) {
					size = randomValue();
				}
				else {
					break;
				}
			}

            listOfAlreadyProcessedCalcul[0] = size;

            answer = listOfCalculs[size].toString();
            indexation = answer.indexOf('=');
			defanswer = answer.toString().substr(indexation + 2);
			listOfCalculResponse[0] = defanswer;

			let calculStr = listOfCalculs[size].toString();
			let calcul = calculStr.substr(0, calculStr.indexOf('=') + 1);
			document.getElementById('newCalcTable').innerHTML = "<table id='myTable' border = 0><tr id = 'line'> <td> </td> <td> " + calcul.toString() + "</td> <td> <input type='text' id='calc0' name='calc' value=''> </td> <td class='resp'> <input type='text' id='answ0' name='answ' value=" + "" + " > </td > </tr ></table > ";

            numberOfCalculs += 1;
			numberofrows += 1;
		}

		function next() {
			// Lorsque le nombre de calcul a été atteint
			if (numberOfCalculs == numberOfCalculsMax) {
				verify();
				return;
			}

			size = randomValue();

            for (i = 0; i < listOfAlreadyProcessedCalcul; i++) {
                if (listOfAlreadyProcessedCalcul[0] == size) {
                    size = randomValue();
                }
                else {
                    break;
                }
            }

			listOfAlreadyProcessedCalcul[numberOfCalculs - 1] = size;

			let calculStr = listOfCalculs[size].toString();
			let calcul = calculStr.substr(0, calculStr.indexOf('=') + 1);
            answer = listOfCalculs[size].toString();
            indexation = answer.indexOf('=');
			defanswer = answer.toString().substr(indexation + 2);
            listOfCalculResponse[numberOfCalculs] = defanswer;

			var table = document.getElementById("myTable");
            var row = table.insertRow(numberofrows);
			var cell1 = row.insertCell(0);
			var cell2 = row.insertCell(1);
			var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
			cell1.innerHTML = "";
			cell2.innerHTML = calcul.toString();
            cell3.innerHTML = "<input type='text' id=" + "calc".concat(numberOfCalculs) + " name='calc' value=''>";
            cell4.innerHTML = "<input type='text' id=" + "answ".concat(numberOfCalculs) + " class='answ' value=" + "" + ">";

			numberofrows += 1; 
			numberOfCalculs = numberOfCalculs + 1;

			hiddenResponse();
        }

		function showResponse() {
            for (i = 0; i < numberOfCalculs; i++) {
                let answer = getResponseById(i);
                document.getElementById("answ".concat(i)).value = 'la réponse est : '.concat(answer.toString());
			}
		}

		function getResponseById(id) {
            return listOfCalculResponse[i];
		}

		function fillListOfUserResponse() {
            for (i = 0; i < numberOfCalculs; i++) {
				listOfUserResponse[0] = document.getElementById("calc".concat(i));
			}
		}

		function getNumberOfErrors() {
			let numberOfErrors = 0;

			for (i = 0; i < numberOfCalculs; i++) {
                if (document.getElementById("calc".concat(i)) != getResponseById(i)) {
					numberOfErrors += 1;
				}
            }

			return numberOfErrors;
		}

        function hiddenResponse() {
            //for (i = 0; i < numberOfCalculs; i++) {
            //    document.getElementById("answ".concat(i)).value = '');
            //}
		}

		let listOfCalculs = [
			['(12 + 12) - (12 + 12) =', '0'],
			['12 + 12 - 12 + 12 =', '24'],
			['Que vaut le double du produit de 12 par 4? =', '24'],
			['6 + 4 x 3 =', '18'],
			['14 - 4^2 =', '-2'],
			['12 - (-12) x 4 =', '60'],
            ['9 - (-9) x 3 =', '36'],
            ['24 : (2 + 3 x 2) =', '3'],
            ['(-16) + (-3) =', '-19'],
            ['Que vaut la diff&#233;rence du carr&#233; de 7 et du cube de 3 ? =', '22'],
            ['3^3 : 3 =', '9'],
			['4^3 - 6^2 =', '28'],
            ['32 : 4^2 =', '2'],
            ['-29 - 28 =', '-57'],
            ['Je choisis un nombre, jajoute 8 et je multiplie le résultat par 5. Jobtiens 60. Quel est ce nombre ? =', '4'],
            ['-27 -27 + (-27) - (-27) =', '-54'],
            ['Ajoute, si nécessaire, des parenthèses pour obtenir le résultat souhaité =', '...'],
			['-28 + 2 x 2^2 =', '-224'],
            ['13 - 3 x 3^3 =', '-14'],
            ['18 + 12 - (-7) + (-21) =', '16'],
            ['Que vaut la somme du carré de 6 et de la diff&#233;rence de 15 et 4? =', '47'],
            ['Calcule la somme de 17.4 et du quotient de 2.1 par 3 =', '18.1'],
            ['45 - (12 + 3^2 x 4) =', '-3'],
			['(-10) + (-13) - (-24) =', '1'],
			['5 + 5 x 4 - 4 : 2 =', '23'],
            ['Que vaut le cube de 8 ? =', '512'],
            ['Que vaut la somme des angles dun triangle? =', '180'],
            ['104 : (-104) =', '-1'],
            ['Je divise un nombre par (-12) et obtiens (-13). Quel est ce nombre ? =', '156'],
            ['(-24) : (-3) =', '8'],
            ['7.6 x 1.1 =', '8.36'],
		];

	</script>
</body>
</html>